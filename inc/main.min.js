var app=new Vue({el:"#lightning",data:{currentFunding:0,pastFundingTargets:[],fundingTargets:[],currentFundingTarget:[],lastFundingIndex:0},methods:{fundingPercentage:function(a){this.percentage=this.currentFunding/a*100;100<this.percentage&&(this.percentage=100);return this.percentage},addNewFundingTarget:function(a){if(a.fundingTarget>app.currentFundingTarget.fundingTarget){app.currentFundingTarget.percentage=0;var b=app.fundingPercentage(a.fundingTarget);app.pastFundingTargets.push(app.currentFundingTarget);
app.currentFundingTarget=a;setTimeout(function(){app.setActive();app.currentFundingTarget.percentage=b},100)}},setNewFunding:function(){var a=0,b=app.lastFundingIndex,c=!0,e=b;0<b&&(c=!1);for(var d={},b=app.lastFundingIndex;b<app.fundingTargets.length;d={next:d.next},b++)app.currentFunding>=app.fundingTargets[b].fundingTarget?(d.next=b+1,d.next in app.fundingTargets&&(a+=2100,app.currentFundingTarget.percentage=100,setTimeout(function(a){return function(){app.addNewFundingTarget(app.fundingTargets[a.next])}}(d),
a),e=d.next)):c&&(setTimeout(function(){app.addNewFundingTarget(app.fundingTargets[e])},a),c=!1),app.lastFundingIndex=e;setTimeout(function(){app.resetActive()},a+2100)},getFundingTitle:function(){return this.currentFundingTarget.fundingTitle},getPercentage:function(){return this.currentFundingTarget.percentage+"%"},setActive:function(){document.querySelector(".progress").classList.add("active")},resetActive:function(){document.querySelector(".progress").classList.remove("active")},getOverallPercentage:function(a){return a/
app.currentFunding*(app.currentFunding/app.currentFundingTarget.fundingTarget)*100+"%"},listenForFunding:function(){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===a.readyState&&200===a.status){var b=JSON.parse(a.responseText);b.donations&&b.donations>app.currentFunding&&(app.currentFunding=b.donations)}};a.open("POST",requestUrl,!0);a.setRequestHeader("Content-type","application/x-www-form-urlencoded");a.send("Action=getdonations")}},watch:{currentFunding:function(){this.setActive();
app.currentFundingTarget.percentage=app.fundingPercentage(app.currentFundingTarget.fundingTarget);app.setNewFunding()}},mounted:function(){this.$nextTick(function(){window.setInterval(function(){app.listenForFunding()},2E3)})},created:function(){console.log("init");loadJSON(function(a){a=JSON.parse(a);app.fundingTargets=a;app.currentFundingTarget=a[0]},document.documentElement.lang)}});
function loadJSON(a,b){var c=new XMLHttpRequest;c.overrideMimeType("application/json");c.open("GET","./inc/"+b+"_fundingTargets.json",!0);c.onreadystatechange=function(){4==c.readyState&&"200"==c.status&&a(c.responseText)};c.send(null)};
